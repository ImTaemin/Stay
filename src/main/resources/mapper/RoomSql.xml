<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="stay.data.mapper.RoomMapper">
	<select id="getRoomCount" resultType="int">
		select count(*) from room
	</select>
	
	<select id="getRoomMaxNo" resultType="int">
		select ifnull(max(no), 0) from room
	</select>
	
	<insert id="insertRoom" parameterType="rdto">
		insert into room values (null, #{host_id}, #{type}, #{addr_load}, #{addr_detail}, #{max_per},
		#{content}, #{name}, #{photos}, #{price}, #{hosting})
	</insert>
	
	<select id="getRooms" parameterType="HashMap" resultType="rdto">
		select * from room order by no limit #{start}, #{perPage}
	</select>
	
	<select id="getRoom" parameterType="String" resultType="rdto">
		select * from room where no = #{no}
	</select>
	
	<update id="updateRoom" parameterType="rdto">
		update room set type = #{type}, addr_load = #{addr_load}, addr_detail = #{addr_detail}, max_per = #{max_per},
		content = #{content}, name = #{name}, price = #{price}, hosting = #{hosting}
		<if test="photos != null">
			, photos = #{photos}
		</if>
		where no = #{no}
	</update>
	
	<select id="getBestRoom" resultType="rdto">
		select * from room r, (select room_no, count(*) cnt from wishlist group by room_no order by cnt desc limit 5) w
		where r.no = w.room_no
	</select>
</mapper>